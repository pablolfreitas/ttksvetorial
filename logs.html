<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logs â€” TTKs Fibrasil</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <header>
    <h1>ðŸ”— TTKs Fibrasil</h1>
    <nav>
      <a href="index.html" class="nav-btn">Abrir Ticket</a>
      <a href="painel.html" class="nav-btn">ðŸ“‹ Painel</a>
      <a href="encerrados.html" class="nav-btn">âœ… Encerrados</a>
      <a href="contatos.html" class="nav-btn">ðŸ“ž Contatos</a>
      <a href="logs.html" class="nav-btn active">ðŸ“„ Logs</a>
    </nav>
  </header>

  <main class="container-wide">
    <div class="painel-header">
      <h2 style="font-size:1rem;color:var(--texto-dim);font-weight:600;">Logs do Sistema</h2>
      <div class="painel-acoes">
        <button id="btn-atualizar" class="btn-secondary">ðŸ”„ Atualizar</button>
        <span id="ultima-atualizacao" class="info-text"></span>
      </div>
    </div>
    <div id="log-wrapper"><div class="loading">Carregando...</div></div>
  </main>

  <div id="alerta" class="alerta hidden"></div>
  <script src="assets/js/supabase-config.js"></script>
  <script>
  const ACAO_ICONE = { "INSERÃ‡ÃƒO":"ðŸŸ¢", "EDIÃ‡ÃƒO":"ðŸ”µ", "ENCERRADO":"âœ…", "DELETE":"ðŸ”´" };
  const ACAO_COR   = { "INSERÃ‡ÃƒO":"#2ecc71", "EDIÃ‡ÃƒO":"#4a90d9", "ENCERRADO":"#f39c12", "DELETE":"#e74c3c" };

  async function carregar() {
    const res = await fetch(
      `${SUPABASE_URL}/rest/v1/logs?select=*&order=criado_em.desc&limit=200`,
      { headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}` } }
    );
    const dados = await res.json();
    const w = document.getElementById("log-wrapper");
    const agora = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
    document.getElementById("ultima-atualizacao").textContent = "Atualizado Ã s " + agora;

    if (!dados.length) { w.innerHTML = `<div class="loading">Nenhum log registrado ainda.</div>`; return; }

    const rows = dados.map(l => {
      const ts = l.criado_em
        ? new Date(l.criado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})
        : "â€”";
      const icone = ACAO_ICONE[l.acao] || "âšª";
      const cor   = ACAO_COR[l.acao]   || "var(--texto-dim)";
      return `<tr>
        <td style="width:40px;text-align:center;font-size:1rem;">${icone}</td>
        <td style="width:120px;font-weight:700;color:${cor};">${l.acao}</td>
        <td class="cell-mono" style="width:180px;">${l.ttk || "â€”"}</td>
        <td style="color:var(--texto-dim);">${l.detalhe || "â€”"}</td>
        <td style="width:100px;color:var(--texto-dim);">${l.usuario || "sistema"}</td>
        <td style="width:120px;color:var(--texto-dim);font-size:0.82rem;">${ts}</td>
      </tr>`;
    }).join("");

    w.innerHTML = `<table class="tickets-table" style="width:100%;">
      <thead><tr>
        <th style="width:40px;"></th>
        <th style="width:120px;">AÃ§Ã£o</th>
        <th style="width:180px;">TTK</th>
        <th>Detalhe</th>
        <th style="width:100px;">UsuÃ¡rio</th>
        <th style="width:120px;">HorÃ¡rio</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
  }
  document.getElementById("btn-atualizar").addEventListener("click", carregar);
  carregar();
  setInterval(carregar, 30000);
  </script>
</body>
</html>
